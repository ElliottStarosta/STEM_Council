<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>STEM Council - Content Manager</title>
  
  <!-- MUST load Identity widget BEFORE Decap CMS -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <!-- CMS mounts here -->
  <script src="https://unpkg.com/decap-cms@^3.3.0/dist/decap-cms.js"></script>
  
  <script>
    console.log('=== Admin Panel Debug ===');
    console.log('Netlify Identity loaded:', typeof netlifyIdentity !== 'undefined');
    console.log('Decap CMS loaded:', typeof CMS !== 'undefined');
    console.log('Current URL:', window.location.href);
    
    // Initialize Netlify Identity
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on('init', user => {
        console.log('Identity initialized');
        console.log('User:', user ? user.email : 'Not logged in');
        
        if (!user) {
          // Open login modal immediately
          console.log('No user found, opening login...');
          window.netlifyIdentity.open();
        }
      });

      // After login, reload to show CMS
      window.netlifyIdentity.on('login', () => {
        console.log('Login successful, reloading...');
        document.location.reload();
      });

      // After logout, go to homepage
      window.netlifyIdentity.on('logout', () => {
        console.log('Logged out');
        document.location.href = '/';
      });

      // Log any errors
      window.netlifyIdentity.on('error', err => {
        console.error('Identity error:', err);
      });
    } else {
      console.error('Netlify Identity not available!');
      console.error('Check that you have enabled Identity in your Netlify dashboard');
    }

    // Check if CMS loaded
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (typeof CMS === 'undefined') {
          console.error('Decap CMS failed to load');
        } else {
          console.log('CMS ready');
        }
      }, 1000);
    });
  </script>
</body>
</html>